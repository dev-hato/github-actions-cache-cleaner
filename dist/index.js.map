{"version":3,"file":"index.js","mappings":";;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;;;;;;;ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACPA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACNA;AACA;;;;;;;ACDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":[".././node_modules/@octokit/request-error/dist-src/index.js","../webpack/bootstrap","../webpack/runtime/define property getters","../webpack/runtime/hasOwnProperty shorthand","../webpack/runtime/make namespace object","../webpack/runtime/compat",".././src/clean-cache.ts"],"sourcesContent":["class RequestError extends Error {\n  name;\n  /**\n   * http status code\n   */\n  status;\n  /**\n   * Request options that lead to the error.\n   */\n  request;\n  /**\n   * Response object if a response was received\n   */\n  response;\n  constructor(message, statusCode, options) {\n    super(message);\n    this.name = \"HttpError\";\n    this.status = Number.parseInt(statusCode);\n    if (Number.isNaN(this.status)) {\n      this.status = 0;\n    }\n    if (\"response\" in options) {\n      this.response = options.response;\n    }\n    const requestCopy = Object.assign({}, options.request);\n    if (options.request.headers.authorization) {\n      requestCopy.headers = Object.assign({}, options.request.headers, {\n        authorization: options.request.headers.authorization.replace(\n          / .*$/,\n          \" [REDACTED]\"\n        )\n      });\n    }\n    requestCopy.url = requestCopy.url.replace(/\\bclient_secret=\\w+/g, \"client_secret=[REDACTED]\").replace(/\\baccess_token=\\w+/g, \"access_token=[REDACTED]\");\n    this.request = requestCopy;\n  }\n}\nexport {\n  RequestError\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\tvar threw = true;\n\ttry {\n\t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\t\tthrew = false;\n\t} finally {\n\t\tif(threw) delete __webpack_module_cache__[moduleId];\n\t}\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","\nif (typeof __webpack_require__ !== 'undefined') __webpack_require__.ab = __dirname + \"/\";","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.script = script;\nconst request_error_1 = require(\"@octokit/request-error\");\nasync function getActionsGetActionsCacheList(github, context) {\n    const actionsGetActionsCacheListParams = {\n        owner: context.repo.owner,\n        repo: context.repo.repo,\n        sort: \"last_accessed_at\",\n        direction: \"asc\",\n    };\n    console.log(\"call actions.getActionsCacheList\", actionsGetActionsCacheListParams);\n    return await github.paginate(github.rest.actions.getActionsCacheList, actionsGetActionsCacheListParams);\n}\nfunction getSumSize(actionsGetActionsCacheList) {\n    return actionsGetActionsCacheList.reduce((sum, size) => { var _a; return sum + ((_a = size.size_in_bytes) !== null && _a !== void 0 ? _a : 0); }, 0);\n}\nasync function script(github, context) {\n    let actionsGetActionsCacheList = await getActionsGetActionsCacheList(github, context);\n    let sumSize = getSumSize(actionsGetActionsCacheList);\n    for (let i = 0; i < 40 && 7 * 1024 * 1024 * 1024 < sumSize; i++) {\n        const actionCache = actionsGetActionsCacheList.shift();\n        if (actionCache === undefined ||\n            actionCache.key === undefined ||\n            actionCache.size_in_bytes === undefined) {\n            continue;\n        }\n        const actionsDeleteActionsCacheByKey = {\n            owner: context.repo.owner,\n            repo: context.repo.repo,\n            key: actionCache.key,\n        };\n        console.log(\"call actions.deleteActionsCacheByKey\", actionsDeleteActionsCacheByKey);\n        try {\n            await github.rest.actions.deleteActionsCacheByKey(actionsDeleteActionsCacheByKey);\n        }\n        catch (e) {\n            if (e instanceof request_error_1.RequestError && e.status === 404) {\n                actionsGetActionsCacheList = await getActionsGetActionsCacheList(github, context);\n                sumSize = getSumSize(actionsGetActionsCacheList);\n                continue;\n            }\n            throw e;\n        }\n        sumSize -= actionCache.size_in_bytes;\n    }\n}\n"],"names":[],"sourceRoot":""}